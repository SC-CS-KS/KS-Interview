<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>分布式架构</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/KS-Interview/assets/css/0.styles.4e743031.css" as="style"><link rel="preload" href="/KS-Interview/assets/js/app.b43e9557.js" as="script"><link rel="preload" href="/KS-Interview/assets/js/2.8729a11c.js" as="script"><link rel="preload" href="/KS-Interview/assets/js/9.7f92937d.js" as="script"><link rel="prefetch" href="/KS-Interview/assets/js/10.5de69b4f.js"><link rel="prefetch" href="/KS-Interview/assets/js/11.e7000444.js"><link rel="prefetch" href="/KS-Interview/assets/js/12.d70e9bc9.js"><link rel="prefetch" href="/KS-Interview/assets/js/13.a0434819.js"><link rel="prefetch" href="/KS-Interview/assets/js/14.61230be2.js"><link rel="prefetch" href="/KS-Interview/assets/js/15.99d0fd12.js"><link rel="prefetch" href="/KS-Interview/assets/js/16.3bfb73bd.js"><link rel="prefetch" href="/KS-Interview/assets/js/17.05106400.js"><link rel="prefetch" href="/KS-Interview/assets/js/18.be2ba26e.js"><link rel="prefetch" href="/KS-Interview/assets/js/19.12a0ad1f.js"><link rel="prefetch" href="/KS-Interview/assets/js/20.eb7f3146.js"><link rel="prefetch" href="/KS-Interview/assets/js/21.528ee2ef.js"><link rel="prefetch" href="/KS-Interview/assets/js/22.285ffa27.js"><link rel="prefetch" href="/KS-Interview/assets/js/23.e6dd1aa4.js"><link rel="prefetch" href="/KS-Interview/assets/js/24.0354243d.js"><link rel="prefetch" href="/KS-Interview/assets/js/25.a37bf3e1.js"><link rel="prefetch" href="/KS-Interview/assets/js/26.09e7f2a9.js"><link rel="prefetch" href="/KS-Interview/assets/js/27.a38ac55e.js"><link rel="prefetch" href="/KS-Interview/assets/js/28.4973789a.js"><link rel="prefetch" href="/KS-Interview/assets/js/29.3046d40c.js"><link rel="prefetch" href="/KS-Interview/assets/js/3.cffc3a8f.js"><link rel="prefetch" href="/KS-Interview/assets/js/30.2edad4cb.js"><link rel="prefetch" href="/KS-Interview/assets/js/31.8dede1df.js"><link rel="prefetch" href="/KS-Interview/assets/js/32.0ff052d0.js"><link rel="prefetch" href="/KS-Interview/assets/js/33.07533d7b.js"><link rel="prefetch" href="/KS-Interview/assets/js/34.46af3186.js"><link rel="prefetch" href="/KS-Interview/assets/js/35.fde43795.js"><link rel="prefetch" href="/KS-Interview/assets/js/36.15337db5.js"><link rel="prefetch" href="/KS-Interview/assets/js/37.d584f13c.js"><link rel="prefetch" href="/KS-Interview/assets/js/38.7cbb50e2.js"><link rel="prefetch" href="/KS-Interview/assets/js/39.0c7c9b55.js"><link rel="prefetch" href="/KS-Interview/assets/js/4.5f60d4ea.js"><link rel="prefetch" href="/KS-Interview/assets/js/40.55f3fd97.js"><link rel="prefetch" href="/KS-Interview/assets/js/41.4cb3e6c9.js"><link rel="prefetch" href="/KS-Interview/assets/js/42.93f6ce68.js"><link rel="prefetch" href="/KS-Interview/assets/js/43.f64aeaaa.js"><link rel="prefetch" href="/KS-Interview/assets/js/44.6dbd7b7a.js"><link rel="prefetch" href="/KS-Interview/assets/js/45.3ca8698f.js"><link rel="prefetch" href="/KS-Interview/assets/js/46.349207e8.js"><link rel="prefetch" href="/KS-Interview/assets/js/47.8c714069.js"><link rel="prefetch" href="/KS-Interview/assets/js/48.c29e743a.js"><link rel="prefetch" href="/KS-Interview/assets/js/49.3d716f14.js"><link rel="prefetch" href="/KS-Interview/assets/js/5.c47523f1.js"><link rel="prefetch" href="/KS-Interview/assets/js/50.4a194a04.js"><link rel="prefetch" href="/KS-Interview/assets/js/51.761714d4.js"><link rel="prefetch" href="/KS-Interview/assets/js/52.6a7426c0.js"><link rel="prefetch" href="/KS-Interview/assets/js/53.f46b25d2.js"><link rel="prefetch" href="/KS-Interview/assets/js/54.174b87cc.js"><link rel="prefetch" href="/KS-Interview/assets/js/55.a0894302.js"><link rel="prefetch" href="/KS-Interview/assets/js/56.e5e26561.js"><link rel="prefetch" href="/KS-Interview/assets/js/57.61642bc8.js"><link rel="prefetch" href="/KS-Interview/assets/js/58.b5649a1d.js"><link rel="prefetch" href="/KS-Interview/assets/js/59.e2678bd7.js"><link rel="prefetch" href="/KS-Interview/assets/js/6.aa8cba10.js"><link rel="prefetch" href="/KS-Interview/assets/js/60.95ca126f.js"><link rel="prefetch" href="/KS-Interview/assets/js/61.0c9bb50f.js"><link rel="prefetch" href="/KS-Interview/assets/js/62.cf97e581.js"><link rel="prefetch" href="/KS-Interview/assets/js/63.72a4c876.js"><link rel="prefetch" href="/KS-Interview/assets/js/64.c6e4f88d.js"><link rel="prefetch" href="/KS-Interview/assets/js/65.22f261f4.js"><link rel="prefetch" href="/KS-Interview/assets/js/66.05eaf510.js"><link rel="prefetch" href="/KS-Interview/assets/js/67.3ff81792.js"><link rel="prefetch" href="/KS-Interview/assets/js/68.f19869ca.js"><link rel="prefetch" href="/KS-Interview/assets/js/69.390aac1e.js"><link rel="prefetch" href="/KS-Interview/assets/js/7.e229e09e.js"><link rel="prefetch" href="/KS-Interview/assets/js/70.57d25018.js"><link rel="prefetch" href="/KS-Interview/assets/js/71.15ee7555.js"><link rel="prefetch" href="/KS-Interview/assets/js/72.78f73e4b.js"><link rel="prefetch" href="/KS-Interview/assets/js/73.14f750d3.js"><link rel="prefetch" href="/KS-Interview/assets/js/74.3cb4bf3e.js"><link rel="prefetch" href="/KS-Interview/assets/js/75.fc469464.js"><link rel="prefetch" href="/KS-Interview/assets/js/8.cd91a8ec.js">
    <link rel="stylesheet" href="/KS-Interview/assets/css/0.styles.4e743031.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/KS-Interview/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="http://www.github.com/sunnnychan" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="http://www.github.com/sunnnychan" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/KS-Interview/CSBasics/" class="sidebar-heading clickable"><span>基础</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/KS-Interview/Java/" class="sidebar-heading clickable"><span>Java</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/KS-Interview/HowToDoInJava/" class="sidebar-heading clickable"><span>HowToDoInJava</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/KS-Interview/Algos/" class="sidebar-heading clickable"><span>算法</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/KS-Interview/Arch/" class="sidebar-heading clickable router-link-active open"><span>架构</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/KS-Interview/Arch/Distributed/" class="active sidebar-link">分布式架构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/KS-Interview/Arch/Distributed/#为什么要进行系统拆分？" class="sidebar-link">为什么要进行系统拆分？</a></li><li class="sidebar-sub-header"><a href="/KS-Interview/Arch/Distributed/#如何进行系统拆分？" class="sidebar-link">如何进行系统拆分？</a></li><li class="sidebar-sub-header"><a href="/KS-Interview/Arch/Distributed/#分布式服务接口的幂等性如何设计（比如不能重复扣款）？" class="sidebar-link">分布式服务接口的幂等性如何设计（比如不能重复扣款）？</a></li><li class="sidebar-sub-header"><a href="/KS-Interview/Arch/Distributed/#分布式服务接口请求的顺序性如何保证？" class="sidebar-link">分布式服务接口请求的顺序性如何保证？</a></li><li class="sidebar-sub-header"><a href="/KS-Interview/Arch/Distributed/#分布式锁的实现方案？哪种效率比较高？" class="sidebar-link">分布式锁的实现方案？哪种效率比较高？</a></li><li class="sidebar-sub-header"><a href="/KS-Interview/Arch/Distributed/#分布式事务了解吗？你们如何解决分布式事务问题的？" class="sidebar-link">分布式事务了解吗？你们如何解决分布式事务问题的？</a></li><li class="sidebar-sub-header"><a href="/KS-Interview/Arch/Distributed/#分布式事务的实现方案？" class="sidebar-link">分布式事务的实现方案？</a></li><li class="sidebar-sub-header"><a href="/KS-Interview/Arch/Distributed/#tcc-如果出现网络连不通怎么办？xa-的一致性如何保证？" class="sidebar-link">TCC 如果出现网络连不通怎么办？XA 的一致性如何保证？</a></li><li class="sidebar-sub-header"><a href="/KS-Interview/Arch/Distributed/#集群部署时的分布式-session-如何实现？" class="sidebar-link">集群部署时的分布式 Session 如何实现？</a></li><li class="sidebar-sub-header"><a href="/KS-Interview/Arch/Distributed/#zookeeper-的使用场景？" class="sidebar-link">Zookeeper 的使用场景？</a></li></ul></li><li><a href="/KS-Interview/Arch/SOA/" class="sidebar-link">面向服务的架构</a></li><li><a href="/KS-Interview/Arch/MicroService/" class="sidebar-link">微服务架构</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/KS-Interview/Infras/" class="sidebar-heading clickable"><span>组件</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/KS-Interview/Database/" class="sidebar-heading clickable"><span>数据库</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/KS-Interview/RD/web/" class="sidebar-link">Web</a></li><li><section class="sidebar-group depth-0"><a href="/KS-Interview/HA/" class="sidebar-heading clickable"><span>高可用</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/KS-Interview/HA/throttling/" class="sidebar-link">限流</a></li><li><a href="/KS-Interview/HA/downgrade/" class="sidebar-link">降级</a></li><li><a href="/KS-Interview/HA/fusing/" class="sidebar-link">熔断</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/KS-Interview/RD/paradigms/" class="sidebar-heading clickable"><span>编程范式</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/KS-Interview/RD/design-pattern/" class="sidebar-link">设计模式</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="分布式架构"><a href="#分布式架构" class="header-anchor">#</a> 分布式架构</h1> <h2 id="为什么要进行系统拆分？"><a href="#为什么要进行系统拆分？" class="header-anchor">#</a> 为什么要进行系统拆分？</h2> <p>业务发展到一定量级，达到单体系统负载极限，无法再承载业务的进一步发展。<br>
通过分而治之的方式，将系统拆分为子系统，进而通过扩展的方式不断适应业务的发展。</p> <p>具体来讲，以下因素是考虑系统拆分的原因：</p> <ol><li>获得更高的系统整体性能；</li> <li>使得系统可维护性、可扩展性增强；</li> <li>增加代码的可维护性，减少代码冲突；</li> <li>增加子系统的边界，保持领域内问题可控。</li></ol> <h2 id="如何进行系统拆分？"><a href="#如何进行系统拆分？" class="header-anchor">#</a> 如何进行系统拆分？</h2> <ol><li>考虑组织架构（康威定理）；</li> <li>考虑领域划分；</li> <li>考虑系统内聚与解耦；</li> <li>考虑系统的分层；</li> <li>考虑模块的代码量。</li></ol> <h2 id="分布式服务接口的幂等性如何设计（比如不能重复扣款）？"><a href="#分布式服务接口的幂等性如何设计（比如不能重复扣款）？" class="header-anchor">#</a> 分布式服务接口的幂等性如何设计（比如不能重复扣款）？</h2> <ul><li>保证幂等性主要是三点：</li></ul> <ol><li>对于每个请求必须有一个唯一的标识；</li> <li>每次处理完请求之后，必须有一个记录标识这个请求处理过了；</li> <li>每次接收请求需要进行判断，判断之前是否处理过。</li></ol> <p>需要结合业务场景解决。<br>
比如利用 Redis，用 orderId 作为唯一键，只有成功插入这个支付流水，才可以执行实际的支付扣款。</p> <h2 id="分布式服务接口请求的顺序性如何保证？"><a href="#分布式服务接口请求的顺序性如何保证？" class="header-anchor">#</a> 分布式服务接口请求的顺序性如何保证？</h2> <p>一旦引入顺序性保障，比如使用分布式锁，会导致系统复杂度上升，而且会带来效率低下，热点数据压力过大等问题。<br>
所以要尽量避免这类需求。</p> <p>一般通过队列来保证。</p> <h2 id="分布式锁的实现方案？哪种效率比较高？"><a href="#分布式锁的实现方案？哪种效率比较高？" class="header-anchor">#</a> 分布式锁的实现方案？哪种效率比较高？</h2> <p>分布式锁有 3 个重要的考量点：<br>
互斥（只能有一个客户端获取锁）<br>
不能死锁<br>
容错（只要大部分 Redis 节点创建了这把锁就可以）</p> <ul><li><p>Redis</p></li> <li><ul><li>SET key value [EX seconds] [PX milliseconds] NX 创建一个 key</li></ul></li> <li><ul><li>RedLock 算法</li></ul></li> <li><p>Zookeeper</p></li></ul> <p>某个节点尝试创建临时 znode，此时创建成功了就获取了这个锁；<br>
这个时候别的客户端来创建锁会失败，只能注册个监听器监听这个锁。<br>
释放锁就是删除这个 znode，一旦释放掉就会通知客户端，然后有一个等待着的客户端就可以再次重新加锁。</p> <ul><li><ul><li>采用另一种方式，创建临时顺序节点：</li></ul></li></ul> <p>如果有一把锁，被多个人给竞争，此时多个人会排队，第一个拿到锁的人会执行，然后释放锁；<br>
后面的每个人都会去监听排在自己前面的那个人创建的 node 上，<br>
一旦某个人释放了锁，排在自己后面的人就会被 ZooKeeper 给通知，<br>
一旦被通知了之后，就 ok 了，自己就获取到了锁，就可以执行代码了。</p> <p>比较：</p> <p>redis 分布式锁，需要自己不断去尝试获取锁，比较消耗性能。
zk 分布式锁，获取不到锁，注册个监听器即可，不需要不断主动尝试获取锁，性能开销较小。</p> <p>如果是 Redis 获取锁的那个客户端 出现 bug 挂了，那么只能等待超时时间之后才能释放锁；<br>
而 zk 的话，因为创建的是临时 znode，只要客户端挂了，znode 就没了，此时就自动释放锁。</p> <h2 id="分布式事务了解吗？你们如何解决分布式事务问题的？"><a href="#分布式事务了解吗？你们如何解决分布式事务问题的？" class="header-anchor">#</a> 分布式事务了解吗？你们如何解决分布式事务问题的？</h2> <h2 id="分布式事务的实现方案？"><a href="#分布式事务的实现方案？" class="header-anchor">#</a> 分布式事务的实现方案？</h2> <ul><li><p>两阶段提交方案/XA方案</p></li> <li><p>TCC 方案<br>
TCC 的全称是： Try 、 Confirm 、 Cancel 。</p></li> <li><p>本地消息表</p></li> <li><p>可靠消息最终一致性方案</p></li> <li><p>最大努力通知方案</p></li></ul> <h2 id="tcc-如果出现网络连不通怎么办？xa-的一致性如何保证？"><a href="#tcc-如果出现网络连不通怎么办？xa-的一致性如何保证？" class="header-anchor">#</a> TCC 如果出现网络连不通怎么办？XA 的一致性如何保证？</h2> <h2 id="集群部署时的分布式-session-如何实现？"><a href="#集群部署时的分布式-session-如何实现？" class="header-anchor">#</a> 集群部署时的分布式 Session 如何实现？</h2> <ul><li>完全不用 Session</li></ul> <p>使用 JWT Token 储存用户身份，然后再从数据库或者 cache 中获取其他的信息。</p> <ul><li>Tomcat + Redis</li></ul> <p>基于 Tomcat 原生的 Session 支持即可，然后就是用一个叫做 Tomcat  RedisSessionManager 的东西，<br>
让所有我们部署的 Tomcat 都将 Session 数据存储到 Redis 即可。</p> <ul><li>Spring Session + Redis</li></ul> <p>给 Spring Session 配置基于 Redis 来存储 Session 数据，<br>
然后配置了一个 Spring Session 的过滤器，这样的话，Session 相关操作都会交给 Spring Session 来管了。<br>
接着在代码中，就用原生的 Session 操作，就是直接基于 Spring Session 从 Redis 中获取数据了。</p> <h2 id="zookeeper-的使用场景？"><a href="#zookeeper-的使用场景？" class="header-anchor">#</a> Zookeeper 的使用场景？</h2> <ul><li>分布式协调</li></ul> <p>如 A 系统发送个请求到 mq，然后 B 系统消息消费之后处理了。那 A 系统如何知道 B 系统的处理结果？</p> <p>A 系统发送请求之后可以在 zookeeper 上对某个节点的值注册个监听器，<br>
一旦 B 系统处理完了就修改 zookeeper 那个节点的值，A 系统立马就可以收到通知，完美解决。</p> <ul><li>分布式锁</li></ul> <p>一个机器接收到了请求之后先获取 zookeeper 上的一把分布式锁，就是可以去创建一个 znode，接着执行操作；<br>
然后另外一个机器也尝试去创建那个 znode，结果发现自己创建不了，<br>
因为被别人创建了，那只能等着，等第一个机器执行完了自己再执行。</p> <ul><li>元数据/配置信息管理</li></ul> <p>zookeeper 可以用作很多系统的配置信息的管理，<br>
比如 kafka、storm 等等很多分布式系统都会选用 zookeeper 来做一些元数据、配置信息的管理。</p> <ul><li>HA高可用性</li></ul> <p>hadoop、hdfs、yarn 等很多大数据系统，都选择基于 zookeeper 来开发 HA 高可用机制，<br>
就是一个重要进程一般会做主备两个，主进程挂了立马通过 zookeeper 感知到切换到备用进程。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/KS-Interview/Algos/LeetCode/" class="prev">
        LeetCode
      </a></span> <span class="next"><a href="/KS-Interview/Arch/SOA/">
        面向服务的架构
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/KS-Interview/assets/js/app.b43e9557.js" defer></script><script src="/KS-Interview/assets/js/2.8729a11c.js" defer></script><script src="/KS-Interview/assets/js/9.7f92937d.js" defer></script>
  </body>
</html>
